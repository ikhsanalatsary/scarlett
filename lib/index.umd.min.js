!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).scarlett={})}(this,(function(e){"use strict";class t extends Error{constructor(e,t){super(t),this.isRestError=!0,this.code="",this.code=e,this.message=this.decorateErrorMessage(t)}decorateErrorMessage(e){return`[${this.code}] ${e}`}consoleTable(...e){return console.table(...e),this}consoleWarn(e){return console.warn(this.decorateErrorMessage(e)),this}consoleError(e){return console.error(this.decorateErrorMessage(e)),this}setRequest(e){return this.request=e,this}setResponse(e){return this.response=e,this.data=e.data,this}throwFilterMatch(e){return!(!this.request||!this.response)&&((!e.path||this.request.url.href.indexOf(e.path)>-1)&&(!e.method||e.method.toLowerCase()===this.request.method.toLowerCase())&&(!e.statusCode||Boolean(e.statusCode===this.response.status)))}}function r(e){let t={};for(let[r]of Object.entries(e)){const s=o(e,r);t[r]=s}return t}function o(e,t){const s=e[t],n=typeof s;if(s){if("string"===n)return String(s);if("number"===n)return Number(s);if("boolean"===n)return Boolean(s);if(globalThis.Headers&&s instanceof Headers)return new Headers(s);if(globalThis.AbortController&&s instanceof AbortController)return new AbortController;if(globalThis.FormData&&s instanceof FormData){const e=new FormData;return s.forEach(((t,r)=>e.append(r,t))),e}return"object"==typeof s?r(s):Array.isArray(s)?s.map(((e,t)=>o(s,t))):s}}function s(e,t){for(let[r]of Object.entries(t)){const o=n(e,t,r);e[r]=o}return e}function n(e,t,r){const o=e[r],n=t[r];if(null==n)return o;if(Array.isArray(n))return o?[...o,...n]:n;if(n instanceof Headers){const e=o;return e?(n.forEach(((t,r)=>{t&&"null"!=t&&"undefined"!=t?e.set(r,t):e.delete(r)})),e):n}return"object"==typeof n?s(null!=o?o:{},n):n}class i{constructor(e,t){this._options=null!=e?e:{},this._restFactory=null!=t?t:a,this.checkAndRestoreDefaults()}checkAndRestoreDefaults(){this._options.overrideStrategy||(this._options.overrideStrategy="merge"),this._options.abortController||(this._options.abortController=new AbortController),this._options.credentials||(this._options.credentials="same-origin"),this._options.mode||(this._options.mode="same-origin"),this._options.cache||(this._options.cache="default"),this._options.redirect||(this._options.redirect="follow"),void 0===this._options.referrer&&(this._options.referrer=""),this._options.referrerPolicy||(this._options.referrerPolicy="no-referrer-when-downgrade"),!this._options.throw&&this._options.throwExcluding&&this._options.throwExcluding.length&&(this._options.throw=!0),this._options.responseType||(this._options.responseType="json"),this._options.timeout||(this._options.timeout=3e4)}current(){return r(this._options)}setFactory(e){return this._restFactory=e,this}createRestClient(){const e=this.clone()._options;return new this._restFactory(e)}get(e){return o(this._options,e)}set(e,t){return this._options[e]=t,this}unset(e){return delete this._options[e],this.checkAndRestoreDefaults(),this}clone(){const e=r(this._options);return new i(e)}merge(e){return s(this._options,null!=e?e:{}),this}assign(e){return Object.assign(this._options,null!=e?e:{}),this}}class a{constructor(e){this._cache=new Map,this.options=new i(null!=e?e:{})}cacheKey(e,t="*",r){var o;const s=(null==r?void 0:r.trim())?r:null!==(o=this.options.get("cacheKey"))&&void 0!==o?o:"";const n=this.options.get("body"),i=this.options.get("responseType"),a=n?"json"===i?JSON.stringify(n):"text"===i?n:"formData"===i?JSON.stringify(function(e){let t={};return e.forEach(((e,r)=>t[r]=e)),t}(n)):"":"";return`${s}|${e.href}|${t}|${a}`}cacheClear(){this._cache.clear()}cacheClearByKey(e){if(e)for(let t of this._cache.keys())t.startsWith(`${e}|`)&&this._cache.delete(t)}cacheSet(e,t){const r=this.cacheKey(e.request.url,e.request.method,t);this._cache.set(r,e)}cacheGet(e,t="*",r){const o=this.cacheKey(e,t,r);return this._cache.get(o)}get(e,t){return this.request("GET",e,t)}delete(e,t){return this.request("DELETE",e,t)}post(e,t){return this.request("POST",e,t)}put(e,t){return this.request("PUT",e,t)}patch(e,t){return this.request("PATCH",e,t)}optionsOverride(e,t){const o=null!=t?t:this.options.current();if("merge"===this.options.get("overrideStrategy")){return s(r(o),null!=e?e:{})}return Object.assign({},o,null!=e?e:{})}async request(e,r,o){var s,n,i;const a=this,c=o?this.optionsOverride(o):this.options.current(),h=function(e=location.origin,t="/",r="/"){return new URL(`${null!=t?t:"/"}/${r}`.replace(/\/+/g,"/"),e)}(c.host,c.basePath,r);if(c.query&&Object.keys(c.query).length&&function(e,r){const o=r.query;if(!o)return;const s=r.queryParamsTransormer,n=Object.keys(o);"function"==typeof s?n.forEach((n=>{const i=o[n];let a=s(n,i,o);"number"==typeof a&&(a=a.toString());const c=typeof a;if("string"!==c&&"undefined"!==c&&null!==a)throw new t("ArgumentException",`Invalid type for '${n}' parameter: \r\n${JSON.stringify(a)}`);e.searchParams.delete(n),a?e.searchParams.append(n,a):!0===r.queryParamsIncludeEmpty&&e.searchParams.append(n,"")})):n.forEach((t=>{const r=o[t];e.searchParams.append(t,null!=r?r:"")}))}(h,c),c.cacheKey=null===(s=c.cacheKey)||void 0===s?void 0:s.trim(),c.internalCache){const t=this.cacheGet(h,e);if(t)return t}const l={method:e,options:c,url:h,body:c.body},u=this.options.get("onRequest");"function"==typeof u&&u(l);const[f,p]=await(d=new Promise(((t,r)=>{var o;let s=!1,n=!1;const i=setTimeout((function(){var e;if(n)return;s=!0,null===(e=c.abortController)||void 0===e||e.abort();let t=new Error;t.name="timeout";const o=(c.timeout/1e3).toFixed(1).replace(".0","");t.message=`Request timeout after ${o} second${"1"==o?"":"s"}.`,r(t)}),c.timeout),a={method:e,body:"GET"===e?void 0:(l=c.body,globalThis.ArrayBuffer&&l instanceof ArrayBuffer&&void 0!==l.byteLength||globalThis.Blob&&l instanceof Blob||globalThis.File&&l instanceof File||globalThis.FormData&&l instanceof FormData||"string"==typeof l?l:JSON.stringify(l)),signal:null===(o=c.abortController)||void 0===o?void 0:o.signal,cache:c.cache,headers:c.headers,credentials:c.credentials,keepalive:c.keepalive,mode:c.mode,redirect:c.redirect,referrerPolicy:c.referrerPolicy,referrer:c.referrer};var l;fetch(h.href,a).then((e=>{s||t(e)})).catch((e=>r(e))).finally((()=>{n=!0,clearTimeout(i)}))})),new Promise((e=>{d.then((t=>e([t,null]))).catch((t=>e([null,t])))})));var d;const[y,g]=await async function(e=null,t="json"){var r;if(!e)return[!1,null];const o="chunked"===e.headers.get("Transfer-Encoding");if(parseInt(null!==(r=e.headers.get("Content-Length"))&&void 0!==r?r:""),204===e.status||o)return[!0,null];try{return[!0,await e[t]()]}catch(e){return[!1,null]}}(f,c.responseType),m={fetchResponse:null!=f?f:void 0,headers:await(null==f?void 0:f.trailer),options:this.options,request:l,data:g,status:null==f?void 0:f.status,repeat(t,o){2==arguments.length?(t=t||e,o=o||{}):1==arguments.length?(o=t||{},t=e):arguments.length||(t=e,o={});const s=a.optionsOverride(o,c);return a.request(t,r,s)}};if(p){const e=new t(p.name,p.message);e.stack=p.stack,"timeout"===e.code&&(m.status=408),e.setRequest(l),e.setResponse(m),m.error=e}else if(y){if(!1===(null==f?void 0:f.ok)){const e=new t(f.status,f.statusText);e.setRequest(l),e.setResponse(m),m.error=e}}else{const e=new t("BodyParseError",`An error occurred while parsing the response body as ${c.responseType}`);e.setRequest(l),e.setResponse(m),m.error=e}if(m.error){const e=this.options.get("onError");if("function"==typeof e&&e(m.error),c.throw){const e=null!==(i=null===(n=c.throwExcluding)||void 0===n?void 0:n.find((e=>m.error.throwFilterMatch(e))))&&void 0!==i&&i;if(!e)throw m.error;"function"==typeof e.onFilterMatch&&e.onFilterMatch(m.error),m.throwFilter=e}}c.internalCache&&this.cacheSet(m);const b=this.options.get("onResponse");return"function"==typeof b&&b(m),m}}e.RestError=t,e.RestOptions=i,e.default=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
